<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Code Runner</title>
        <style>
            body {
                background-color: black;
                color: green;
                text-align: center;
            }
            canvas {
                border: 1px solid green;
                background-color: #EFC;
            }
        </style>
        <script>
            var room = 'room';
        </script>
    </head>
    <body>
        <h1>Code Runner</h1>
        <canvas id="c"></canvas>
        <script>
            var images = {};

            function draw(map) {
                var ctx = document.getElementById('c').getContext('2d');

                var grid = map.split('\n').map(function(x) {
                    return x.split('');
                });

                var h = grid.length;
                var w = grid[0].length;

                document.getElementById('c').width = w * 32;
                document.getElementById('c').height = h * 32;

                grid.forEach(function(row, y) {

                    row.forEach(function(e, x) {
                        if(e in images)
                            ctx.drawImage(images[e], x * 32, y * 32);
                    });
                });
            }

            document.addEventListener('DOMContentLoaded', function() {

                ["-","@","$","&","H","S","X","#"].forEach(function(e) {
                    var img = new Image();
                    img.src = "img/" + e.replace('#', '%23') + ".png";
                    images[e] = img;
                });

                var ws = new WebSocket('ws://localhost:1338/' + room);
                ws.onmessage = function(msg) {
                    draw(msg.data);
                };
            });
        </script>
    </body>
</html>
